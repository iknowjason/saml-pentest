require 'uri'
require 'base64'
require 'zlib'

# URL-decode
str = URI.unescape ARGV[0]

# base64 decode
data = Base64.decode64(str)

# Inflate
replace_str = Zlib::Inflate.new(-15).inflate(data)

#puts replace_str

#substitute string
malicious_response = replace_str.gsub("string1", "string2")
puts malicious_response

# Deflate
def gzdeflate (s)
    Zlib::Deflate.new(nil, -Zlib::MAX_WBITS).deflate(s, Zlib::FINISH)
end
comp = gzdeflate(malicious_response)

# Base64 Encode
comp2 = Base64.strict_encode64(comp)

# URL encode
puts URI.escape(comp2, '+/=')
